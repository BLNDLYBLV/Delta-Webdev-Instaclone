<%- include('partials/header') %>

<% function givename(id){ %>
    <% for( var x=0;x<names.length;x++){ %>
    <%      if(names[x].id==id){ %>
    <%          from=names[x].username;break; %>    
    <%      } %>   
    <% }%> 
  <% return from }%>
  <span id="ousertxt" style="display: none;">
    <%=  ouser.id %>
  </span>
<span id="origusername" style="display: none;"> <%= user.id%> </span>

<div style="position: fixed;left: 20%;top: 10%; width: 1015px;height: 630px;background-color: white;">
    <img style=" width: 595px;height: 630px;" src="/uploads/<%= post.image  %>" alt="">
    <span style="display: inline-block;">
      <div style=" margin-left: -5px;width: 421px; border-bottom: 1px solid rgba(0,0,0,0.1); position: absolute;top: 8px;padding: 10px;padding-bottom: 15px;">
        <img style="margin-left: 5px; width: 40px;height: 40px; border-radius: 50% ;" src="<%= ouser.profpic %>" alt="">
        <span style="position: relative;top: 1.5px; margin-left: 15px;font-size: 16px;font-weight: 600;"> <%= ouser.username %> </span>
      </div>
      <div id="commentbox<%= post.id %>" style="overflow: auto; border-bottom: 1px solid rgba(0,0,0,0.1); height: 380px;width: 421px; margin-left: -5px; position: absolute;top: 80px;padding: 10px;">
        <div style="margin-bottom: 15px;">
          <img style="margin-left: 5px; width: 40px;height: 40px; border-radius: 50% ;" src="<%= ouser.profpic %>" alt="">
          <span style="position: relative;top: 1.5px; margin-left: 15px;font-size: 16px;font-weight: 600;"> <%= ouser.username %> </span>
          <span style="position: relative;top: 1.5px; margin-left: 5px;font-size: 14px;font-weight: 350;"> <%= post.caption %> </span>
        </div>
          <% maxcomm=0; %>
          <% commflag=0; %>
          <% if(comments!=null){%>
              <%comments.forEach(comm=>{ %>    
              <% if(comm.postid==post.id ){ %>
                <% for( var x=0;x<names.length;x++){ %>
                <%      if(names[x].id==comm.from){ %>
                <%          from=names[x].username;break; %>    
                <%      } %>   
                <% }%>  
                <div style="margin-left: -5px; margin-bottom: 7px;">
                  <span style="position: relative;top: 1.5px; margin-left: 15px;font-size: 15px;font-weight: 400;"><strong> <%= from %> </strong> </span>
                  <span style="position: relative;top: 1.5px; margin-left: 5px;font-size: 14px;font-weight: 350;"> <%= comm.comment %> </span>
                </div>
                  <% maxcomm++; %>
              <% } %>        
          <% })} %>    
      </div>
      <div style="padding: 15px; position: relative;top: 245px; margin-left: -5px; border-bottom: 1px solid rgba(0,0,0,0.1);height: 115px;width: 420px;">
        <div id="likeicon<%=post.id %>" onclick="like('<%= post.id %>','<%= user.id %>','<%= post.likesid %>')" style="padding: 6px; font-size: 27px;" class="<%= post.likesid.includes(user.id) ? 'fas' : 'far' ;%> fa-heart"></div>
        <div style="padding: 6px; font-size: 27px;" class="far fa-comment"></div>
        <div style="padding: 6px; font-size: 27px;" class="far fa-paper-plane"></div>
        <% if(post.likesid.length==0){ %>
          <div><%= post.likesid.length %> likes</div>
        <% }else{ %>
          <div style="padding-left: 10px;">
            Liked by <%= givename(post.likesid[0]) %> <span> <% if(post.likesid.length==2){%><%=','+givename(post.likesid[1])%><% } %> <% if(post.likesid.length>2){%><%=' and '+(post.likesid.length-1)+' others' %><% } %> </span>
          </div>
        <% } %> 
        <div style="position: relative;top: 42px;">
          <input style="width: 330px; padding: 10px;border: none;" type="text" placeholder="Add comment" name="" id="feedcomminp<%= post.id %>">
          <button onclick="comment('<%= post.id %>','<%= user.id %>','<%= user.username %>','<%= post.ownerid %>')" style="border: none;background-color: rgba(0,0,0,0); color: rgb(0,123,250);font-weight: bold;font-size: medium;margin-left: 7px;">Post</button>
        </div> 
      </div>
    </span>
  </div>

  <script src="/oprofile.js"></script>
  <script src="/socket.js"></script>
  <script>
    // var fileInput = document.getElementById('profpicchange');
    // var form =document.getElementById('profpicform') ;
    var postidloc;
    var closebtn;
  
    // var handleFiles = () => {
    //   console.log("works");
    //   form.submit();
    // }
  
  
  
  // fileInput.addEventListener("change", handleFiles);
  window.addEventListener('click',(e)=>{
    // console.log("goes inside");
    // console.log(e.target);
    if(e.target.id=='modalof'+postidloc)
    {
      var postmodal=document.getElementById('modalof'+postidloc);
      postmodal.style.display='none';
    }
  });
  
  function modalposton(postid) {
    var postmodal=document.getElementById('modalof'+postid);
    closebtn=document.getElementById('modalclose'+postid);
    closebtn.addEventListener('click',()=>{
      // console.log("listens");
      var postmodal=document.getElementById('modalof'+postidloc);
      postmodal.style.display='none';
    });
    postidloc=postid;
    postmodal.style.display='block';
  }
  
  </script>
<%- include('partials/footer') %> 
